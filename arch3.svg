<svg viewBox="0 0 1800 3200" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="900" y="40" font-size="32" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Complete GPU-Driven Rendering Pipeline
  </text>
  <text x="900" y="75" font-size="16" text-anchor="middle" fill="#7f8c8d">
    Bindless Descriptors + Multi-Draw Indirect + GPU Culling
  </text>
  
  <!-- ===== PHASE 0: SETUP ===== -->
  <rect x="50" y="110" width="1700" height="380" fill="#e8f4f8" stroke="#3498db" stroke-width="3" rx="10"/>
  <text x="900" y="150" font-size="24" font-weight="bold" text-anchor="middle" fill="#2980b9">
    PHASE 0: Initial Setup (Once at startup or when scene changes)
  </text>
  
  <!-- CPU Side Setup -->
  <g transform="translate(80, 180)">
    <rect x="0" y="0" width="800" height="280" fill="#fff" stroke="#3498db" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="18" font-weight="bold" text-anchor="middle" fill="#2980b9">
      CPU: Scene Data Preparation
    </text>
    
    <!-- Material buffer -->
    <rect x="20" y="50" width="360" height="70" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="200" y="70" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">Material Storage Buffer</text>
    <text x="30" y="90" font-size="10" font-family="monospace" fill="#ecf0f1">materials[0] = {albedoTint, tilingX, tilingY,</text>
    <text x="30" y="105" font-size="10" font-family="monospace" fill="#ecf0f1">               albedoTexIdx:5, normalTexIdx:12}</text>
    
    <!-- Transform buffer -->
    <rect x="400" y="50" width="360" height="70" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="580" y="70" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">Transform Storage Buffer</text>
    <text x="410" y="90" font-size="10" font-family="monospace" fill="#ecf0f1">transforms[0] = {mat4x3 worldMatrix}</text>
    <text x="410" y="105" font-size="10" font-family="monospace" fill="#ecf0f1">transforms[1] = {mat4x3 worldMatrix}</text>
    
    <!-- Draw data buffer -->
    <rect x="20" y="135" width="360" height="70" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="200" y="155" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">Draw Data Storage Buffer</text>
    <text x="30" y="175" font-size="10" font-family="monospace" fill="#ecf0f1">drawData[0] = {materialIdx:0, transformIdx:0,</text>
    <text x="30" y="190" font-size="10" font-family="monospace" fill="#ecf0f1">               vertexOffset:0, indexOffset:0}</text>
    
    <!-- Vertex buffer -->
    <rect x="400" y="135" width="360" height="70" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="580" y="155" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">Vertex Storage Buffer</text>
    <text x="410" y="175" font-size="10" font-family="monospace" fill="#ecf0f1">vertices = {pos, normal, uv, tangent...}</text>
    <text x="410" y="190" font-size="10" font-family="monospace" fill="#ecf0f1">All meshes in one large buffer</text>
    
    <!-- Object data -->
    <rect x="20" y="220" width="740" height="50" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="4"/>
    <text x="390" y="240" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">Object/Instance Data (for GPU culling)</text>
    <text x="30" y="258" font-size="10" font-family="monospace" fill="#ecf0f1">
      objects[i] = {boundingSphere, drawDataIndex, pipelineID, LODLevel, ...}
    </text>
  </g>
  
  <!-- GPU Side Setup -->
  <g transform="translate(920, 180)">
    <rect x="0" y="0" width="800" height="280" fill="#fff" stroke="#3498db" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="18" font-weight="bold" text-anchor="middle" fill="#2980b9">
      GPU: Descriptor Set Layout
    </text>
    
    <!-- Global descriptor set -->
    <rect x="20" y="50" width="760" height="210" fill="#ecf0f1" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="400" y="75" font-size="14" font-weight="bold" text-anchor="middle" fill="#2980b9">
      Set 0 - Global Bindless Descriptor Set
    </text>
    
    <g transform="translate(40, 90)">
      <text x="0" y="0" font-size="11" font-weight="bold" fill="#2c3e50">Binding 0: materialBuffer (STORAGE_BUFFER)</text>
      <text x="0" y="20" font-size="11" font-weight="bold" fill="#2c3e50">Binding 1: transformBuffer (STORAGE_BUFFER)</text>
      <text x="0" y="40" font-size="11" font-weight="bold" fill="#2c3e50">Binding 2: drawDataBuffer (STORAGE_BUFFER)</text>
      <text x="0" y="60" font-size="11" font-weight="bold" fill="#2c3e50">Binding 3: vertexBuffer (STORAGE_BUFFER)</text>
      <text x="0" y="80" font-size="11" font-weight="bold" fill="#2c3e50">Binding 4: indexBuffer (STORAGE_BUFFER)</text>
      <text x="0" y="100" font-size="11" font-weight="bold" fill="#2c3e50">Binding 5: materialTextures[] (SAMPLED_IMAGE array)</text>
      <text x="20" y="118" font-size="10" font-style="italic" fill="#7f8c8d">‚Üë Descriptor array of all scene textures (NOT texture array!)</text>
      <text x="0" y="138" font-size="11" font-weight="bold" fill="#2c3e50">Binding 6: samplers[] (SAMPLER array)</text>
      <text x="0" y="158" font-size="11" font-weight="bold" fill="#2c3e50">Binding 7: uniformData (UNIFORM_BUFFER)</text>
      <text x="20" y="176" font-size="10" font-style="italic" fill="#7f8c8d">‚Üë View/projection matrices, time, etc.</text>
    </g>
  </g>
  
  <!-- ===== PHASE 1: CPU FRAME PREP ===== -->
  <rect x="50" y="520" width="1700" height="300" fill="#fff9e6" stroke="#f39c12" stroke-width="3" rx="10"/>
  <text x="900" y="560" font-size="24" font-weight="bold" text-anchor="middle" fill="#d68910">
    PHASE 1: CPU Frame Preparation (Per Frame)
  </text>
  
  <g transform="translate(80, 590)">
    <rect x="0" y="0" width="1640" height="210" fill="#fff" stroke="#f39c12" stroke-width="2" rx="6"/>
    
    <g transform="translate(30, 30)">
      <text x="0" y="0" font-size="14" font-weight="bold" fill="#d68910">Step 1.1: Update Dynamic Data</text>
      <text x="20" y="25" font-size="12" fill="#2c3e50">‚Ä¢ Update camera matrices in uniform buffer</text>
      <text x="20" y="45" font-size="12" fill="#2c3e50">‚Ä¢ Update transforms for animated objects</text>
      <text x="20" y="65" font-size="12" fill="#2c3e50">‚Ä¢ Update material parameters if changed</text>
      
      <text x="800" y="0" font-size="14" font-weight="bold" fill="#d68910">Step 1.2: Bind Global State (ONCE)</text>
      <text x="820" y="25" font-size="12" font-family="monospace" fill="#2c3e50">vkCmdBindDescriptorSets(cmd, SET_0);</text>
      <text x="820" y="45" font-size="12" font-family="monospace" fill="#2c3e50">vkCmdBindIndexBuffer(cmd, indexBuf, ...);</text>
      <text x="820" y="70" font-size="11" font-style="italic" fill="#27ae60">‚úì All scene data now accessible!</text>
      
      <text x="0" y="110" font-size="14" font-weight="bold" fill="#d68910">Step 1.3: Prepare for GPU Culling</text>
      <text x="20" y="135" font-size="12" fill="#2c3e50">‚Ä¢ Upload frustum planes to GPU buffer</text>
      <text x="20" y="155" font-size="12" fill="#2c3e50">‚Ä¢ Reset draw count buffer to 0</text>
      <text x="20" y="175" font-size="12" fill="#2c3e50">‚Ä¢ Set up compute shader for culling</text>
    </g>
  </g>
  
  <!-- ===== PHASE 2: GPU CULLING ===== -->
  <rect x="50" y="850" width="1700" height="520" fill="#f0e8f8" stroke="#9b59b6" stroke-width="3" rx="10"/>
  <text x="900" y="890" font-size="24" font-weight="bold" text-anchor="middle" fill="#8e44ad">
    PHASE 2: GPU Compute Culling (Parallel on GPU)
  </text>
  
  <!-- Input data -->
  <g transform="translate(80, 920)">
    <rect x="0" y="0" width="530" height="200" fill="#fff" stroke="#9b59b6" stroke-width="2" rx="6"/>
    <text x="265" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#8e44ad">Input Data</text>
    
    <rect x="20" y="50" width="490" height="130" fill="#ecf0f1" stroke="#9b59b6" stroke-width="1" rx="4"/>
    <text x="30" y="72" font-size="11" font-weight="bold" fill="#2c3e50">Read from GPU buffers:</text>
    <text x="40" y="92" font-size="10" fill="#2c3e50">‚Ä¢ objects[] - bounding volumes, indices</text>
    <text x="40" y="108" font-size="10" fill="#2c3e50">‚Ä¢ frustumPlanes[] - view frustum</text>
    <text x="40" y="124" font-size="10" fill="#2c3e50">‚Ä¢ occlusionData[] (optional) - Hi-Z buffer</text>
    <text x="40" y="140" font-size="10" fill="#2c3e50">‚Ä¢ LOD parameters - distance thresholds</text>
    <text x="40" y="156" font-size="10" fill="#2c3e50">‚Ä¢ drawData[] - to get mesh info</text>
  </g>
  
  <!-- Compute shader -->
  <g transform="translate(640, 920)">
    <rect x="0" y="0" width="530" height="200" fill="#2c3e50" stroke="#9b59b6" stroke-width="2" rx="6"/>
    <text x="265" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">Compute Shader (Parallel)</text>
    
    <rect x="20" y="50" width="490" height="130" fill="#34495e" stroke="#9b59b6" stroke-width="1" rx="4"/>
    <text x="30" y="70" font-size="10" font-family="monospace" fill="#52c9a5">layout(local_size_x = 64) in;</text>
    <text x="30" y="87" font-size="10" font-family="monospace" fill="#fff">uint objID = gl_GlobalInvocationID.x;</text>
    <text x="30" y="104" font-size="10" font-family="monospace" fill="#fff">Object obj = objects[objID];</text>
    <text x="30" y="121" font-size="10" font-family="monospace" fill="#e74c3c">if (frustumCull(obj) && occlusionCull(obj)) {</text>
    <text x="40" y="138" font-size="10" font-family="monospace" fill="#27ae60">  uint idx = atomicAdd(drawCount, 1);</text>
    <text x="40" y="155" font-size="10" font-family="monospace" fill="#27ae60">  writeDrawCommand(idx, obj);</text>
    <text x="30" y="172" font-size="10" font-family="monospace" fill="#e74c3c">}</text>
  </g>
  
  <!-- Output -->
  <g transform="translate(1200, 920)">
    <rect x="0" y="0" width="530" height="200" fill="#fff" stroke="#9b59b6" stroke-width="2" rx="6"/>
    <text x="265" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#8e44ad">Output Buffers</text>
    
    <rect x="20" y="50" width="490" height="130" fill="#ecf0f1" stroke="#9b59b6" stroke-width="1" rx="4"/>
    <text x="30" y="72" font-size="11" font-weight="bold" fill="#2c3e50">Written atomically:</text>
    <text x="40" y="92" font-size="10" fill="#27ae60">‚Ä¢ drawCommands[] - VkDrawIndirectCmd</text>
    <text x="40" y="108" font-size="10" fill="#27ae60">‚Ä¢ drawCount - number of visible objects</text>
    <text x="40" y="124" font-size="10" fill="#7f8c8d">‚Ä¢ (Optional) sorted by pipeline/material</text>
    <text x="40" y="140" font-size="10" fill="#7f8c8d">‚Ä¢ (Optional) instance data for instancing</text>
  </g>
  
  <!-- Detailed draw command structure -->
  <g transform="translate(80, 1150)">
    <rect x="0" y="0" width="1640" height="200" fill="#fff" stroke="#e74c3c" stroke-width="2" rx="6"/>
    <text x="820" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#c0392b">
      Draw Command Buffer Layout (GPU Writes, GPU Reads)
    </text>
    
    <g transform="translate(50, 60)">
      <text x="0" y="0" font-size="12" font-weight="bold" fill="#2c3e50">struct VkDrawIndexedIndirectCommand drawCommands[MAX_DRAWS]:</text>
      
      <!-- Command 0 -->
      <rect x="0" y="15" width="1540" height="50" fill="#fef5e7" stroke="#f39c12" stroke-width="1" rx="3"/>
      <text x="10" y="35" font-size="11" font-weight="bold" fill="#d68910">[0]</text>
      
      <rect x="60" y="20" width="140" height="40" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="2"/>
      <text x="130" y="35" font-size="9" text-anchor="middle" fill="#fff">indexCount</text>
      <text x="130" y="50" font-size="9" text-anchor="middle" fill="#ecf0f1">1234</text>
      
      <rect x="210" y="20" width="140" height="40" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="2"/>
      <text x="280" y="35" font-size="9" text-anchor="middle" fill="#fff">instanceCount</text>
      <text x="280" y="50" font-size="9" text-anchor="middle" fill="#ecf0f1">1</text>
      
      <rect x="360" y="20" width="140" height="40" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="2"/>
      <text x="430" y="35" font-size="9" text-anchor="middle" fill="#fff">firstIndex</text>
      <text x="430" y="50" font-size="9" text-anchor="middle" fill="#ecf0f1">5000</text>
      
      <rect x="510" y="20" width="140" height="40" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="2"/>
      <text x="580" y="35" font-size="9" text-anchor="middle" fill="#fff">vertexOffset</text>
      <text x="580" y="50" font-size="9" text-anchor="middle" fill="#ecf0f1">0</text>
      
      <rect x="660" y="20" width="180" height="40" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="2"/>
      <text x="750" y="35" font-size="9" text-anchor="middle" fill="#fff">firstInstance</text>
      <text x="750" y="50" font-size="9" font-weight="bold" text-anchor="middle" fill="#fff">42</text>
      
      <text x="860" y="45" font-size="11" fill="#e74c3c">‚Üê This becomes gl_DrawID or gl_InstanceIndex</text>
      <text x="1180" y="45" font-size="11" fill="#7f8c8d">Use as drawDataIndex!</text>
      
      <!-- Command 1 -->
      <rect x="0" y="75" width="1540" height="50" fill="#fef5e7" stroke="#f39c12" stroke-width="1" rx="3"/>
      <text x="10" y="95" font-size="11" font-weight="bold" fill="#d68910">[1]</text>
      <text x="130" y="100" font-size="9" text-anchor="middle" fill="#2c3e50">567, 1, 8000, 0, </text>
      <text x="750" y="100" font-size="9" font-weight="bold" text-anchor="middle" fill="#e74c3c">87</text>
      <text x="860" y="100" font-size="11" fill="#7f8c8d">‚Üê Different drawDataIndex</text>
      
      <text x="400" y="145" font-size="11" font-style="italic" text-anchor="middle" fill="#7f8c8d">
        ... thousands more commands written by GPU culling shader ...
      </text>
    </g>
  </g>
  
  <!-- ===== PHASE 3: MULTI-DRAW INDIRECT ===== -->
  <rect x="50" y="1400" width="1700" height="450" fill="#e8f8e8" stroke="#27ae60" stroke-width="3" rx="10"/>
  <text x="900" y="1440" font-size="24" font-weight="bold" text-anchor="middle" fill="#229954">
    PHASE 3: Multi-Draw Indirect Execution
  </text>
  
  <!-- CPU command -->
  <g transform="translate(80, 1470)">
    <rect x="0" y="0" width="800" height="200" fill="#fff" stroke="#27ae60" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="18" font-weight="bold" text-anchor="middle" fill="#27ae60">
      CPU: Single Command Per Pipeline
    </text>
    
    <rect x="20" y="50" width="760" height="130" fill="#ecf0f1" stroke="#27ae60" stroke-width="1" rx="4"/>
    <text x="30" y="75" font-size="12" font-family="monospace" fill="#2c3e50">// For opaque geometry pipeline</text>
    <text x="30" y="95" font-size="12" font-family="monospace" fill="#2c3e50">vkCmdBindPipeline(cmd, opaquePipeline);</text>
    <text x="30" y="115" font-size="12" font-family="monospace" fill="#27ae60">vkCmdDrawIndexedIndirectCount(</text>
    <text x="50" y="135" font-size="12" font-family="monospace" fill="#27ae60">  cmd, drawBuffer, offsetOpaque,</text>
    <text x="50" y="155" font-size="12" font-family="monospace" fill="#27ae60">  countBuffer, countOffsetOpaque, maxDraws);</text>
    
    <text x="400" y="195" font-size="11" font-style="italic" text-anchor="middle" fill="#7f8c8d">
      Repeat for each pipeline bucket (transparent, shadow, etc.)
    </text>
  </g>
  
  <!-- GPU execution detail -->
  <g transform="translate(920, 1470)">
    <rect x="0" y="0" width="800" height="200" fill="#fff" stroke="#27ae60" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="18" font-weight="bold" text-anchor="middle" fill="#27ae60">
      GPU: Parallel Draw Execution
    </text>
    
    <rect x="20" y="50" width="760" height="130" fill="#2c3e50" stroke="#27ae60" stroke-width="1" rx="4"/>
    <text x="30" y="75" font-size="11" font-family="monospace" fill="#7f8c8d">// GPU hardware does this automatically:</text>
    <text x="30" y="95" font-size="11" font-family="monospace" fill="#fff">uint count = countBuffer[countOffset];</text>
    <text x="30" y="115" font-size="11" font-family="monospace" fill="#fff">for (uint i = 0; i &lt; min(count, maxDraws); i++) {</text>
    <text x="50" y="135" font-size="11" font-family="monospace" fill="#52c9a5">  VkDrawCmd cmd = drawBuffer[offset + i];</text>
    <text x="50" y="155" font-size="11" font-family="monospace" fill="#52c9a5">  executeDrawIndexed(cmd); // gl_DrawID = i</text>
    <text x="30" y="175" font-size="11" font-family="monospace" fill="#fff">}</text>
  </g>
  
  <!-- Pipeline bucketing diagram -->
  <g transform="translate(80, 1700)">
    <rect x="0" y="0" width="1640" height="130" fill="#fff9e6" stroke="#f39c12" stroke-width="2" rx="6"/>
    <text x="820" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#d68910">
      Pipeline Bucketing Strategy
    </text>
    
    <g transform="translate(50, 50)">
      <rect x="0" y="0" width="350" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
      <text x="175" y="25" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Opaque Pipeline</text>
      <text x="175" y="45" font-size="10" text-anchor="middle" fill="#ecf0f1">Draws 0-5432</text>
      
      <rect x="380" y="0" width="350" height="60" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="4"/>
      <text x="555" y="25" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Transparent Pipeline</text>
      <text x="555" y="45" font-size="10" text-anchor="middle" fill="#ecf0f1">Draws 5433-6789</text>
      
      <rect x="760" y="0" width="350" height="60" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2" rx="4"/>
      <text x="935" y="25" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Shadow Pipeline</text>
      <text x="935" y="45" font-size="10" text-anchor="middle" fill="#ecf0f1">Draws 6790-8234</text>
      
      <rect x="1140" y="0" width="350" height="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="4"/>
      <text x="1315" y="25" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Post-Process Pipeline</text>
      <text x="1315" y="45" font-size="10" text-anchor="middle" fill="#ecf0f1">Draws 8235-8240</text>
    </g>
  </g>
  
  <!-- ===== PHASE 4: SHADER EXECUTION ===== -->
  <rect x="50" y="1880" width="1700" height="600" fill="#f0f0f5" stroke="#34495e" stroke-width="3" rx="10"/>
  <text x="900" y="1920" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    PHASE 4: Shader Execution with Bindless Lookups
  </text>
  
  <!-- Data flow diagram -->
  <g transform="translate(80, 1950)">
    <!-- gl_DrawID -->
    <rect x="0" y="0" width="200" height="60" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="4"/>
    <text x="100" y="25" font-size="13" font-weight="bold" text-anchor="middle" fill="#fff">gl_DrawIDARB</text>
    <text x="100" y="45" font-size="12" text-anchor="middle" fill="#ecf0f1">= 42</text>
    
    <path d="M 200 30 L 270 30" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrow-red)"/>
    
    <!-- DrawData lookup -->
    <rect x="270" y="0" width="280" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="4"/>
    <text x="410" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">DrawData Lookup</text>
    <text x="280" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">drawData[42] = {</text>
    <text x="280" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">  mat:5, trans:12, vert:3000}</text>
    
    <!-- Branch to three paths -->
    <path d="M 550 30 L 620 30" stroke="#3498db" stroke-width="3"/>
    <path d="M 620 30 L 620 90" stroke="#3498db" stroke-width="3"/>
    <path d="M 620 90 L 700 90" stroke="#27ae60" stroke-width="3" marker-end="url(#arrow-green)"/>
    <path d="M 620 30 L 700 30" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow-orange)"/>
    <path d="M 620 30 L 620 -30" stroke="#3498db" stroke-width="3"/>
    <path d="M 620 -30 L 700 -30" stroke="#9b59b6" stroke-width="3" marker-end="url(#arrow-purple)"/>
  </g>
  
  <!-- Material path -->
  <g transform="translate(780, 1920)">
    <rect x="0" y="0" width="380" height="60" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="4"/>
    <text x="190" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Material Lookup</text>
    <text x="10" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#2c3e50">MaterialData md = materials[5];</text>
    <text x="10" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#2c3e50">{tint, tiling, albedoTexIdx:42...}</text>
    
    <path d="M 380 30 L 450 30" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow-orange)"/>
    
    <rect x="450" y="0" width="380" height="60" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="4"/>
    <text x="640" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Texture Lookup</text>
    <text x="460" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">texture(sampler2D(</text>
    <text x="460" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">  materialTextures[42], samp), uv)</text>
  </g>
  
  <!-- Transform path -->
  <g transform="translate(780, 1980)">
    <rect x="0" y="0" width="380" height="60" fill="#27ae60" stroke="#229954" stroke-width="2" rx="4"/>
    <text x="190" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Transform Lookup</text>
    <text x="10" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">TransformData td = transforms[12];</text>
    <text x="10" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">mat4x3 worldMatrix = td.transform;</text>
    
    <path d="M 380 30 L 450 30" stroke="#27ae60" stroke-width="3" marker-end="url(#arrow-green)"/>
    
    <rect x="450" y="0" width="380" height="60" fill="#229954" stroke="#1e8449" stroke-width="2" rx="4"/>
    <text x="640" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Vertex Transform</text>
    <text x="460" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">posWorld = worldMatrix *</text>
    <text x="460" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">           positionLocal;</text>
  </g>
  
  <!-- Vertex path -->
  <g transform="translate(780, 2040)">
    <rect x="0" y="0" width="380" height="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="4"/>
    <text x="190" y="20" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">Vertex Fetch</text>
    <text x="10" y="40" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">uint idx = gl_VertexIndex + 3000;</text>
    <text x="10" y="55" font-size="10" font-family="monospace" text-anchor="start" fill="#ecf0f1">vec3 pos = vertexData[idx].position;</text>
  </g>
  
  <!-- Complete shader code examples -->
  <g transform="translate(80, 2140)">
    <rect x="0" y="0" width="800" height="310" fill="#2c3e50" stroke="#34495e" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#ecf0f1">
      Complete Vertex Shader
    </text>
    
    <rect x="20" y="45" width="760" height="245" fill="#1a1a1a" stroke="#34495e" stroke-width="1" rx="4"/>
    <text x="30" y="65" font-size="10" font-family="monospace" fill="#52c9a5">#extension GL_ARB_shader_draw_parameters : require</text>
    <text x="30" y="80" font-size="10" font-family="monospace" fill="#52c9a5">#extension GL_EXT_buffer_reference : require</text>
    <text x="30" y="100" font-size="10" font-family="monospace" fill="#7f8c8d">// Bindless descriptor set bindings</text>
    <text x="30" y="115" font-size="10" font-family="monospace" fill="#fff">layout(set=0, binding=2) buffer DrawDataBuf {</text>
    <text x="40" y="130" font-size="10" font-family="monospace" fill="#fff">  DrawData data[];</text>
    <text x="30" y="145" font-size="10" font-family="monospace" fill="#fff">} drawData;</text>
    <text x="30" y="165" font-size="10" font-family="monospace" fill="#fff">void main() {</text>
    <text x="40" y="180" font-size="10" font-family="monospace" fill="#e74c3c">  uint drawID = gl_DrawIDARB;</text>
    <text x="40" y="195" font-size="10" font-family="monospace" fill="#3498db">  DrawData dd = drawData.data[drawID];</text>
    <text x="40" y="210" font-size="10" font-family="monospace" fill="#27ae60">  TransformData td = transforms.data[dd.transformIdx];</text>
    <text x="40" y="225" font-size="10" font-family="monospace" fill="#9b59b6">  uint vIdx = gl_VertexIndex + dd.vertexOffset;</text>
    <text x="40" y="240" font-size="10" font-family="monospace" fill="#9b59b6">  vec3 posLocal = vertices.data[vIdx].position;</text>
    <text x="40" y="255" font-size="10" font-family="monospace" fill="#27ae60">  vec3 posWorld = td.transform * vec4(posLocal, 1.0);</text>
    <text x="40" y="270" font-size="10" font-family="monospace" fill="#fff">  gl_Position = ubo.viewProj * vec4(posWorld, 1.0);</text>
    <text x="30" y="285" font-size="10" font-family="monospace" fill="#fff">}</text>
  </g>
  
  <g transform="translate(920, 2140)">
    <rect x="0" y="0" width="800" height="310" fill="#2c3e50" stroke="#34495e" stroke-width="2" rx="6"/>
    <text x="400" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#ecf0f1">
      Complete Fragment Shader
    </text>
    
    <rect x="20" y="45" width="760" height="245" fill="#1a1a1a" stroke="#34495e" stroke-width="1" rx="4"/>
    <text x="30" y="65" font-size="10" font-family="monospace" fill="#52c9a5">#extension GL_ARB_shader_draw_parameters : require</text>
    <text x="30" y="85" font-size="10" font-family="monospace" fill="#7f8c8d">// Descriptor array for all textures</text>
    <text x="30" y="100" font-size="10" font-family="monospace" fill="#fff">layout(set=0, binding=5) uniform sampler2D</text>
    <text x="40" y="115" font-size="10" font-family="monospace" fill="#fff">  materialTextures[];</text>
    <text x="30" y="135" font-size="10" font-family="monospace" fill="#fff">layout(location=0) in vec2 uv;</text>
    <text x="30" y="150" font-size="10" font-family="monospace" fill="#fff">layout(location=0) out vec4 outColor;</text>
    <text x="30" y="170" font-size="10" font-family="monospace" fill="#fff">void main() {</text>
    <text x="40" y="185" font-size="10" font-family="monospace" fill="#e74c3c">  uint drawID = gl_DrawIDARB;</text>
    <text x="40" y="200" font-size="10" font-family="monospace" fill="#3498db">  DrawData dd = drawData.data[drawID];</text>
    <text x="40" y="215" font-size="10" font-family="monospace" fill="#f39c12">  MaterialData md = materials.data[dd.materialIdx];</text>
    <text x="40" y="235" font-size="10" font-family="monospace" fill="#e74c3c">  vec4 albedo = texture(</text>
    <text x="50" y="250" font-size="10" font-family="monospace" fill="#e74c3c">    materialTextures[md.albedoTexIdx], uv);</text>
    <text x="40" y="265" font-size="10" font-family="monospace" fill="#fff">  outColor = albedo * md.albedoTint;</text>
    <text x="30" y="280" font-size="10" font-family="monospace" fill="#fff">}</text>
  </g>
  
  <!-- ===== PERFORMANCE METRICS ===== -->
  <rect x="50" y="2510" width="1700" height="250" fill="#e8f8e8" stroke="#27ae60" stroke-width="3" rx="10"/>
  <text x="900" y="2550" font-size="24" font-weight="bold" text-anchor="middle" fill="#229954">
    Performance Comparison
  </text>
  
  <g transform="translate(80, 2590)">
    <!-- Traditional approach -->
    <rect x="0" y="0" width="520" height="150" fill="#ffe8e8" stroke="#e74c3c" stroke-width="2" rx="6"/>
    <text x="260" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#c0392b">
      ‚ùå Traditional (Per-Draw Binding)
    </text>
    <text x="20" y="60" font-size="12" fill="#2c3e50">Scene: 100,000 objects, 50,000 visible</text>
    <text x="20" y="85" font-size="12" fill="#e74c3c">‚Ä¢ CPU: 50,000 vkCmd calls</text>
    <text x="20" y="105" font-size="12" fill="#e74c3c">‚Ä¢ CPU: Culling all objects</text>
    <text x="20" y="125" font-size="12" fill="#e74c3c">‚Ä¢ Frame time: ~8-12ms CPU bound</text>
    
    <!-- GPU-driven approach -->
    <rect x="560" y="0" width="520" height="150" fill="#e8f8e8" stroke="#27ae60" stroke-width="2" rx="6"/>
    <text x="820" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#229954">
      ‚úÖ GPU-Driven (Multi-Draw Indirect)
    </text>
    <text x="580" y="60" font-size="12" fill="#2c3e50">Scene: 100,000 objects, 50,000 visible</text>
    <text x="580" y="85" font-size="12" fill="#27ae60">‚Ä¢ CPU: 1-5 vkCmd calls (per pipeline)</text>
    <text x="580" y="105" font-size="12" fill="#27ae60">‚Ä¢ GPU: Parallel culling compute</text>
    <text x="580" y="125" font-size="12" fill="#27ae60">‚Ä¢ Frame time: ~1-2ms CPU, GPU does work</text>
    
    <!-- Hybrid approach -->
    <rect x="1120" y="0" width="520" height="150" fill="#fff9e6" stroke="#f39c12" stroke-width="2" rx="6"/>
    <text x="1380" y="30" font-size="16" font-weight="bold" text-anchor="middle" fill="#d68910">
      üí° Hybrid Approach (Recommended)
    </text>
    <text x="1140" y="60" font-size="12" fill="#2c3e50">Combine strategies:</text>
    <text x="1140" y="85" font-size="12" fill="#f39c12">‚Ä¢ GPU-driven for main world</text>
    <text x="1140" y="105" font-size="12" fill="#f39c12">‚Ä¢ Traditional for UI/post-processing</text>
    <text x="1140" y="125" font-size="12" fill="#27ae60">‚Ä¢ Best of both worlds!</text>
  </g>
  
  <!-- ===== KEY REQUIREMENTS ===== -->
  <rect x="50" y="2790" width="1700" height="180" fill="#fff" stroke="#34495e" stroke-width="3" rx="10"/>
  <text x="900" y="2830" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Requirements &amp; Extensions
  </text>
  
  <g transform="translate(80, 2860)">
    <text x="0" y="0" font-size="14" font-weight="bold" fill="#2980b9">Vulkan Extensions Required:</text>
    <text x="20" y="25" font-size="12" fill="#2c3e50">‚Ä¢ VK_EXT_descriptor_indexing (Core in Vulkan 1.2) - For bindless texture arrays</text>
    <text x="20" y="45" font-size="12" fill="#2c3e50">‚Ä¢ VK_KHR_draw_indirect_count (Core in Vulkan 1.2) - For GPU-driven draw count</text>
    <text x="20" y="65" font-size="12" fill="#2c3e50">‚Ä¢ VK_KHR_shader_draw_parameters (Core in Vulkan 1.1) - For gl_DrawID in shaders</text>
    
    <text x="850" y="0" font-size="14" font-weight="bold" fill="#e74c3c">Hardware Limits to Check:</text>
    <text x="870" y="25" font-size="12" fill="#2c3e50">‚Ä¢ maxPerStageDescriptorSampledImages (need 1000s)</text>
    <text x="870" y="45" font-size="12" fill="#2c3e50">‚Ä¢ maxDrawIndirectCount (max draws per call)</text>
    <text x="870" y="65" font-size="12" fill="#2c3e50">‚Ä¢ maxStorageBufferRange (for large buffers)</text>
    
    <text x="0" y="105" font-size="14" font-weight="bold" fill="#27ae60">Shader Extensions:</text>
    <text x="20" y="130" font-size="12" font-family="monospace" fill="#2c3e50">#extension GL_ARB_shader_draw_parameters : require</text>
    <text x="20" y="150" font-size="12" font-family="monospace" fill="#2c3e50">#extension GL_EXT_nonuniform_qualifier : enable  // Optional but helpful</text>
  </g>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#27ae60"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f39c12"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#9b59b6"/>
    </marker>
  </defs>
</svg>
